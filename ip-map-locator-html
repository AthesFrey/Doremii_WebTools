<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>发现你了!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />

  <style>
    body {
      margin: 0;
      padding: 16px;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "微软雅黑", sans-serif;
      background: #f5f5f5;
    }

    .ip-map-card {
      max-width: 520px;
      margin: 0 auto;
      padding: 12px 14px 16px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .ip-map-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 8px;
    }

    .info-line {
      font-size: 13px;
      margin: 3px 0;
      color: #333;
      word-break: break-all;
    }

    .info-label {
      color: #888;
      margin-right: 4px;
    }

    #map {
      width: 100%;
      height: 260px;
      margin-top: 10px;
      border-radius: 8px;
      overflow: hidden;
    }

    .tip {
      margin-top: 8px;
      font-size: 11px;
      color: #999;
      line-height: 1.4;
    }

    .manual-row {
      margin-top: 6px;
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      align-items: center;
    }

    #manual-ip-input {
      flex: 1;
      max-width: 220px;
      height: 24px;
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid #e0e0e0;  /* 细边框 */
      background: #ffffff;         /* 和卡片背景一致 */
      font-size: 11px;
      box-sizing: border-box;
    }

    #manual-ip-input::placeholder {
      color: #bbb;
    }

    #manual-ip-btn {
      height: 24px;
      padding: 0 16px;             /* 稍微拉长一点 */
      font-size: 11px;
      border-radius: 4px;
      border: 1px solid #dddddd;
      background: #fafafa;
      cursor: pointer;
      box-sizing: border-box;
    }

    #manual-ip-btn:hover {
      background: #f0f0f0;
    }

    /* ============================
       追加：暗色主题（保守覆盖）
       - 支持 html[data-theme="dark"]（你全站按钮常用方式）
       - 也支持系统暗色 prefers-color-scheme
       ============================ */

    html[data-theme="dark"] body {
      background: #0b1220;
      color: #e5e7eb;
    }
    html[data-theme="dark"] .ip-map-card {
      background: #0f172a;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
    }
    html[data-theme="dark"] .ip-map-title { color: #e5e7eb; }
    html[data-theme="dark"] .info-line { color: #e5e7eb; }
    html[data-theme="dark"] .info-label { color: #a8b3c7; }
    html[data-theme="dark"] .tip { color: #94a3b8; }

    html[data-theme="dark"] #manual-ip-input {
      background: #0b1220;
      color: #e5e7eb;
      border-color: rgba(255,255,255,0.14);
    }
    html[data-theme="dark"] #manual-ip-input::placeholder {
      color: rgba(229,231,235,0.45);
    }
    html[data-theme="dark"] #manual-ip-btn {
      background: rgba(255,255,255,0.06);
      color: #e5e7eb;
      border-color: rgba(255,255,255,0.14);
    }
    html[data-theme="dark"] #manual-ip-btn:hover {
      background: rgba(255,255,255,0.10);
    }

    @media (prefers-color-scheme: dark) {
      html:not([data-theme="light"]) body {
        background: #0b1220;
        color: #e5e7eb;
      }
      html:not([data-theme="light"]) .ip-map-card {
        background: #0f172a;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
      }
      html:not([data-theme="light"]) .ip-map-title { color: #e5e7eb; }
      html:not([data-theme="light"]) .info-line { color: #e5e7eb; }
      html:not([data-theme="light"]) .info-label { color: #a8b3c7; }
      html:not([data-theme="light"]) .tip { color: #94a3b8; }

      html:not([data-theme="light"]) #manual-ip-input {
        background: #0b1220;
        color: #e5e7eb;
        border-color: rgba(255,255,255,0.14);
      }
      html:not([data-theme="light"]) #manual-ip-input::placeholder {
        color: rgba(229,231,235,0.45);
      }
      html:not([data-theme="light"]) #manual-ip-btn {
        background: rgba(255,255,255,0.06);
        color: #e5e7eb;
        border-color: rgba(255,255,255,0.14);
      }
      html:not([data-theme="light"]) #manual-ip-btn:hover {
        background: rgba(255,255,255,0.10);
      }
    }
  </style>

  <!-- 1. 高德安全密钥：必须在加载 JSAPI 之前设置 -->
  <script type="text/javascript">
    window._AMapSecurityConfig = {
      // TODO：换成你自己申请的 JSAPI 安全密钥 jscode
      securityJsCode: '3f6fc59c90d8c7f8afad06ade9245bcb'
    };
  </script>

  <!-- 2. 直接加载高德 JS API（不用 loader.js） -->
  <!-- TODO：换成你自己的 Web 端 JSAPI Key，并在高德控制台配置好当前域名白名单 -->
  <script src="https://webapi.amap.com/maps?v=2.0&key=6cd6a8409708cae39d0797b5a0c23c90"></script>

  <!-- 3. 外部 JS 文件（新版 v20251125V2） -->
  <!-- 建议你改个版本号强刷缓存，比如 ?v=20251125V7 -->
  <script src="/wp-content/uploads/ip-map-locator.js?v=20251125V7"></script>
</head>
<body>
  <div class="ip-map-card">
    <h1 class="ip-map-title">发现你了!</h1>

    <div class="info-line">
      <span class="info-label">IP：</span>
      <span id="ip-value">获取中…</span>
    </div>
    <div class="info-line">
      <span class="info-label">位置：</span>
      <span id="location-value">获取中…</span>
    </div>

    <div id="map"></div>

    <div class="tip">
      说明：<br>
      IP 定位一般只能精确到城市 / 区县级别，并非 GPS 精确点位。
    </div>

    <!-- 手动 IP 查询行 -->
    <div class="manual-row">
      <input
        type="text"
        id="manual-ip-input"
        autocomplete="off"
        placeholder="在此输入 IP 后点击 track"
      />
      <button type="button" id="manual-ip-btn">track</button>
    </div>
  </div>
</body>
</html>
