<div class="doremii-timer" data-doremii-timer>
  <div class="doremii-timebox" aria-live="polite">
    <span class="doremii-time" data-role="display">00:00:00.000</span>
  </div>
  <button class="doremii-btn doremii-primary" data-role="toggle" type="button">暂停</button>
  <button class="doremii-btn doremii-danger"  data-role="reset"  type="button">重置</button>
</div>

<style>
  .doremii-timer{
    width: 520px;
    max-width: 100%;
    margin: 12px auto;
    padding: 6px;
    display: flex;
    gap: 6px;
    align-items: stretch;
    border-radius: 14px;
    border: 1px solid var(--d-border, rgba(255,255,255,.14));
    background: var(--d-card, rgba(255,255,255,.06));
    backdrop-filter: blur(10px);
    box-sizing: border-box;
  }
  .doremii-timer *{ box-sizing: border-box; }

  .doremii-timebox{
    flex: 1 1 auto;
    min-width: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px 8px;
    min-height: 34px;
    border-radius: 12px;
    border: 1px solid var(--d-border, rgba(255,255,255,.14));
    background: rgba(0,0,0,.08);
  }

  :root:not([data-theme="dark"]) .doremii-timebox{
    background: rgba(255,255,255,.55);
  }

  .doremii-time{
    display: block;
    width: 100%;
    text-align: center;
    white-space: nowrap;
    user-select: none;
    color: var(--d-text, #e5e7eb);
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum" 1, "liga" 0, "kern" 0;
    font-kerning: none;
    -webkit-font-smoothing: antialiased;
    text-rendering: geometricPrecision;
    font-size: clamp(13px, 4.8vw, 18px);
    line-height: 1.05;
    margin: 0;
  }

  .doremii-btn{
    flex: 0 0 auto;
    height: 34px;
    width: 66px;
    padding: 0 10px;
    border-radius: 12px;
    border: 1px solid var(--d-border, rgba(255,255,255,.14));
    background: rgba(255,255,255,.06);
    color: var(--d-text, #e5e7eb);
    font-size: 13px;
    font-weight: 400;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    user-select: none;
    appearance: none;
  }
  .doremii-btn:active{ transform: translateY(1px); }

  .doremii-primary{
    border-color: rgba(96,165,250,.40);
    background: rgba(96,165,250,.12);
  }
  .doremii-danger{
    border-color: rgba(251,113,133,.38);
    background: rgba(251,113,133,.10);
  }

  @media (max-width: 420px){
    .doremii-timer{ padding: 6px; gap: 6px; }
    .doremii-timebox{ min-height: 32px; padding: 5px 7px; }
    .doremii-btn{ height: 32px; width: 62px; font-size: 12.5px; }
    .doremii-time{ font-size: clamp(12.5px, 5.2vw, 17px); }
  }
</style>

<script>
  (function(){
    function pad2(n){ return String(n).padStart(2,"0"); }
    function pad3(n){ return String(n).padStart(3,"0"); }
    function fmt(ms){
      ms = Math.max(0, Math.floor(ms));
      const h = Math.floor(ms/3600000); ms%=3600000;
      const m = Math.floor(ms/60000);   ms%=60000;
      const s = Math.floor(ms/1000);    ms%=1000;
      return `${pad2(h)}:${pad2(m)}:${pad2(s)}.${pad3(ms)}`;
    }

    document.querySelectorAll('[data-doremii-timer]').forEach(host=>{
      if (host.dataset.inited === "1") return;
      host.dataset.inited = "1";

      const display = host.querySelector('[data-role="display"]');
      const toggle  = host.querySelector('[data-role="toggle"]');
      const reset   = host.querySelector('[data-role="reset"]');
      if (!display || !toggle || !reset) return;

      let running = true;
      let startRef = performance.now();
      let elapsed = 0;
      let raf = 0;

      function render(now){ display.textContent = fmt(elapsed + (now - startRef)); }
      function tick(now){ if (!running) return; render(now); raf = requestAnimationFrame(tick); }

      function setRun(on){
        if (running === on) return;
        if (on){
          startRef = performance.now();
          running = true;
          toggle.textContent = "暂停";
          cancelAnimationFrame(raf);
          raf = requestAnimationFrame(tick);
        }else{
          elapsed += (performance.now() - startRef);
          running = false;
          toggle.textContent = "继续";
          cancelAnimationFrame(raf);
          render(performance.now());
        }
      }

      toggle.addEventListener("click", ()=>setRun(!running));
      reset.addEventListener("click", ()=>{
        elapsed = 0;
        display.textContent = "00:00:00.000";
        if (running) startRef = performance.now();
      });

      requestAnimationFrame(tick);
    });
  })();
</script>
